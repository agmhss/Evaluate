<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Answer Scoring Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background:#f4f5fb; padding:20px; }
  h1 { text-align:center; color:#333; }
  .box {
    background:white; padding:15px; margin-bottom:15px;
    border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
  }
  textarea {
    width:100%; min-height:100px;
    border-radius:6px; border:1px solid #aaa;
    padding:8px; font-family:inherit; font-size:14px;
  }
  label { font-weight:bold; display:block; margin-bottom:6px; }
  button {
    background:#4b0082; color:white; border:none;
    padding:10px 18px; border-radius:8px;
    cursor:pointer; font-size:15px;
  }
  button:disabled { opacity:0.6; cursor:not-allowed; }
  #resultScore { font-size:20px; font-weight:bold; margin-top:10px; }
  #resultFeedback { margin-top:6px; white-space:pre-wrap; }
</style>
</head>
<body>

<h1>üìù AI Answer Scoring</h1>

<div class="box">
  <label for="question">Question (optional, but helps AI)</label>
  <textarea id="question" placeholder="E.g. Explain the process of photosynthesis."></textarea>
</div>

<div class="box">
  <label for="answerKey">Answer Key (Teacher's Reference Answer)</label>
  <textarea id="answerKey" placeholder="Type the correct model answer here..."></textarea>
</div>

<div class="box">
  <label for="studentAnswer">Student's Script / Answer</label>
  <textarea id="studentAnswer" placeholder="Paste or type the student's answer here..."></textarea>
</div>

<div class="box">
  <button id="scoreBtn" onclick="scoreWithAI()">Score with AI</button>
  <span id="status" style="margin-left:10px; font-size:13px; color:#555;"></span>
  <div id="resultScore"></div>
  <div id="resultFeedback"></div>
</div>

<script>
// ‚ö†Ô∏è For personal/local use only ‚Äì don‚Äôt expose this key on public sites.
const OPENAI_API_KEY = "YOUR_API_KEY_HERE";

// Call OpenAI API to score the answer
async function scoreWithAI() {
  const question = document.getElementById('question').value.trim();
  const answerKey = document.getElementById('answerKey').value.trim();
  const studentAnswer = document.getElementById('studentAnswer').value.trim();
  const statusEl = document.getElementById('status');
  const scoreEl = document.getElementById('resultScore');
  const feedbackEl = document.getElementById('resultFeedback');
  const btn = document.getElementById('scoreBtn');

  scoreEl.textContent = "";
  feedbackEl.textContent = "";

  if (!answerKey || !studentAnswer) {
    alert("Please enter both the Answer Key and the Student's Answer.");
    return;
  }

  btn.disabled = true;
  statusEl.textContent = "Scoring with AI...";

  try {
    const prompt = `
You are a strict but fair exam evaluator.

Compare the STUDENT_ANSWER to the ANSWER_KEY for the QUESTION.

- Give a score from 0 to 10.
- Consider: correctness, coverage of key points, clarity, and relevance.
- Be concise.

Return ONLY valid JSON in this format:
{"score": number, "feedback": "short explanation"}

QUESTION:
${question || "(No question text provided)"}

ANSWER_KEY:
${answerKey}

STUDENT_ANSWER:
${studentAnswer}
`;

    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + OPENAI_API_KEY
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",   // or another chat-capable model
        messages: [
          { role: "system", content: "You are an exam grading assistant. Always respond with valid JSON." },
          { role: "user", content: prompt }
        ],
        temperature: 0.2
      })
    });

    if (!response.ok) {
      throw new Error("API error: " + response.status + " " + (await response.text()));
    }

    const data = await response.json();
    const content = data.choices[0].message.content.trim();

    // Try to parse JSON returned by the model
    let result;
    try {
      result = JSON.parse(content);
    } catch (e) {
      // If the model added extra text around JSON, try to extract JSON part
      const jsonMatch = content.match(/\{[\s\S]*\}/);
      if (jsonMatch) {
        result = JSON.parse(jsonMatch[0]);
      } else {
        throw new Error("Could not parse AI response as JSON:\n" + content);
      }
    }

    const score = result.score;
    const feedback = result.feedback || "";

    scoreEl.textContent = `Score: ${score} / 10`;
    feedbackEl.textContent = `Feedback: ${feedback}`;

  } catch (err) {
    console.error(err);
    alert("Error while scoring: " + err.message);
  } finally {
    btn.disabled = false;
    statusEl.textContent = "";
  }
}
</script>

</body>
</html>
